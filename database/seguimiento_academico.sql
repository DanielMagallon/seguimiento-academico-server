--
-- PostgreSQL database dump
--

-- Dumped from database version 13.4
-- Dumped by pg_dump version 13.4

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- Name: get_session(character varying, character varying); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.get_session(nrocontrol_t character varying, password_tutor character varying) RETURNS refcursor
    LANGUAGE plpgsql
    AS $$
	
	declare  
		ref1  refcursor;
	
	begin
	
		open ref1 for select idgrupo from grupos 
			where nrocontrol_tutor=(select nrocontrol from tutores 
				where nrocontrol=nrocontrol_t and password=password_tutor);
			
		return ref1;
	end;
$$;


ALTER FUNCTION public.get_session(nrocontrol_t character varying, password_tutor character varying) OWNER TO postgres;

--
-- Name: get_session(character varying, character varying, boolean); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.get_session(nro_control character varying, clave character varying, intutores boolean) RETURNS refcursor
    LANGUAGE plpgsql
    AS $$
	
	declare  
		ref1  refcursor;
	
	begin
		if intutores then
			open ref1 for select grupos.idgrupo,grupos.nombre,carreras.nombre from grupos
				inner join carreras on carreras.idcarrera=grupos.idcarrera 
				where activo and nrocontrol_tutor=(select nrocontrol from tutores 
					where nrocontrol=nro_control and password=clave);
		else
			open ref1 for select alumnos.nombre,apellido1,apellido2,grupos.idgrupo,grupos.nombre from alumnos
					inner join grupos on grupos.idgrupo=alumnos.idgrupo 
					where nrocontrol=nro_control and password=clave;
		end if;
		
		return ref1;
	end;
$$;


ALTER FUNCTION public.get_session(nro_control character varying, clave character varying, intutores boolean) OWNER TO postgres;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- Name: alumnos; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.alumnos (
    nombre character varying(30) NOT NULL,
    apellido1 character varying(15) NOT NULL,
    apellido2 character varying(15),
    idgrupo integer NOT NULL,
    nrocontrol character varying(10) NOT NULL,
    password character varying(100) NOT NULL
);


ALTER TABLE public.alumnos OWNER TO postgres;

--
-- Name: alumnos_materias; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.alumnos_materias (
    nrocontrol character varying(10) NOT NULL,
    codigo_materia character varying(15) NOT NULL,
    calificacion real DEFAULT 0,
    oportunidad integer DEFAULT 1,
    asesoria boolean DEFAULT false,
    activo boolean DEFAULT true
);


ALTER TABLE public.alumnos_materias OWNER TO postgres;

--
-- Name: carreras; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.carreras (
    idcarrera integer NOT NULL,
    nombre character varying(50) NOT NULL,
    tipo character varying(15) NOT NULL,
    total_creditos integer NOT NULL
);


ALTER TABLE public.carreras OWNER TO postgres;

--
-- Name: carreras_idcarrera_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.carreras ALTER COLUMN idcarrera ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.carreras_idcarrera_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: grupos; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.grupos (
    idgrupo integer NOT NULL,
    nombre character varying(20) NOT NULL,
    nrocontrol_tutor character varying(10) NOT NULL,
    cicloescolar character varying(30) NOT NULL,
    idcarrera integer NOT NULL,
    activo boolean DEFAULT false
);


ALTER TABLE public.grupos OWNER TO postgres;

--
-- Name: grupo_tutorias_idgrupo_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.grupos ALTER COLUMN idgrupo ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.grupo_tutorias_idgrupo_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: materias; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.materias (
    codigo_materia character varying(15) NOT NULL,
    nombre character varying(40) NOT NULL,
    creditos integer
);


ALTER TABLE public.materias OWNER TO postgres;

--
-- Name: tutores; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.tutores (
    nrocontrol character varying(10) NOT NULL,
    nombre character varying(40) NOT NULL,
    apellido1 character varying(15) NOT NULL,
    apellido2 character varying(15),
    idcarrera integer,
    password character varying(100) NOT NULL
);


ALTER TABLE public.tutores OWNER TO postgres;

--
-- Data for Name: alumnos; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.alumnos (nombre, apellido1, apellido2, idgrupo, nrocontrol, password) FROM stdin;
Edgar Daniel	Magallon	Villanueva	2	17420571	12345
Luis Jose	Ixta	Zamudio	2	17420565	12345
Javier	Ayala	Chabelo	2	17420575	12345
Andre	Mugia	Jafet	2	17420578	12345
Jose Juan	Rangel	Bolanos	2	17420579	12345
Efrain	Tovar	Meza	2	17420580	12345
Alejandro	Hernandez	Ortega	2	17420581	12345
Jose Antonio	Toro	Padilla	2	17420583	12345
Jose Eduardo	Poo	Tapia	1	17420600	12345
Andrei	Rivera	Arroyo	1	17420572	12345
Julio	Campos	Ochoa	1	17420574	12345
Bryant	Robles	Oregel	1	17420576	12345
Daniel Alejandro	Magallon	Contreras	1	17420585	12345
Roxana	Ibeth	Nunez	1	17420586	12345
Jesus	Bautista	Torres	3	17420573	12345
Jaime Daniel	Girarte	Gonzalez	3	17420552	12345
Cesar Alejandro	Ochoa	Cardenas	3	17420577	12345
Edgar Ivan	Blas	Pena	3	17420582	12345
Juan Pablo	Valencia	Hetfield	3	17420584	12345
Alejandra	Vega	Lopez	3	17420587	12345
Priscila	Cortez	Hernandez	4	19420500	12345
Eugenio	Derbez	Peluche	4	19420501	12345
Benito	Juarez	Magallon	4	19420502	12345
Luis	Damian	Hernandez	4	19420503	12345
Charlie	Chaplin	Ochoa	5	19420504	12345
Alfonso	Magallon	Montes	5	19420505	12345
Ricardo	Granados	Aguilar	5	19420506	12345
Hanna	Mendez	Avalos	6	19420507	12345
Abril	Montes	Mejia	6	19420508	12345
James	Shadow	Hetfield	6	19420509	12345
Diego	Santiilan	Jimenez	7	18420600	12345
Erick	Villanueva	Magallon	7	18420601	12345
Roberto	Maldonado	Mendoza	7	18420602	12345
Irving	Sanchez	Sanchez	7	18420603	12345
Marco	Ravelo	Murguia	8	18420604	12345
Saul	Gonzalez	Montes	8	18420605	12345
Barbie	Nunez	de Magallon	8	18420606	12345
Yarely	Villa	Flores	9	18420607	12345
Adrian	Ceja	Renteria	9	18420608	12345
Raul	Arceo	Melgoza	9	18420609	12345
\.


--
-- Data for Name: alumnos_materias; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.alumnos_materias (nrocontrol, codigo_materia, calificacion, oportunidad, asesoria, activo) FROM stdin;
17420571	SADG-20	80	1	f	t
17420571	SADG-27	80	1	f	t
17420571	SAIS-100	60	3	f	f
17420571	SADG-22	80	3	f	f
17420571	SAIS-101	0	3	f	t
17420571	SAIS-104	0	1	f	t
17420565	SADG-20	0	1	f	t
17420565	SAIS-100	0	1	f	t
17420565	SADG-22	0	1	f	t
17420565	SAIS-101	0	1	f	t
17420565	SADG-27	0	1	f	t
17420565	SAIS-104	0	1	f	t
17420575	SADG-20	0	1	f	t
17420575	SAIS-100	0	1	f	t
17420575	SADG-22	0	1	f	t
17420575	SAIS-101	0	1	f	t
17420575	SADG-27	0	1	f	t
17420575	SAIS-104	0	1	f	t
17420578	SADG-20	0	1	f	t
17420578	SAIS-100	0	1	f	t
17420578	SADG-22	0	1	f	t
17420578	SAIS-101	0	1	f	t
17420578	SADG-27	0	1	f	t
17420578	SAIS-104	0	1	f	t
17420579	SADG-20	0	1	f	t
17420579	SAIS-100	0	1	f	t
17420579	SADG-22	0	1	f	t
17420579	SAIS-101	0	1	f	t
17420579	SADG-27	0	1	f	t
17420579	SAIS-104	0	1	f	t
17420580	SADG-20	0	1	f	t
17420580	SAIS-100	0	1	f	t
17420580	SADG-22	0	1	f	t
17420580	SAIS-101	0	1	f	t
17420580	SADG-27	0	1	f	t
17420580	SAIS-104	0	1	f	t
17420581	SADG-20	0	1	f	t
17420581	SAIS-100	0	1	f	t
17420581	SADG-22	0	1	f	t
17420581	SAIS-101	0	1	f	t
17420581	SADG-27	0	1	f	t
17420581	SAIS-104	0	1	f	t
17420583	SADG-20	0	1	f	t
17420583	SAIS-100	0	1	f	t
17420583	SADG-22	0	1	f	t
17420583	SAIS-101	0	1	f	t
17420583	SADG-27	0	1	f	t
17420583	SAIS-104	0	1	f	t
17420600	SADG-20	0	1	f	t
17420600	SAIS-100	0	1	f	t
17420600	SADG-22	0	1	f	t
17420600	SAIS-101	0	1	f	t
17420600	SADG-27	0	1	f	t
17420600	SAIS-104	0	1	f	t
17420572	SADG-20	0	1	f	t
17420572	SAIS-100	0	1	f	t
17420572	SADG-22	0	1	f	t
17420572	SAIS-101	0	1	f	t
17420572	SADG-27	0	1	f	t
17420572	SAIS-104	0	1	f	t
17420574	SADG-20	0	1	f	t
17420574	SAIS-100	0	1	f	t
17420574	SADG-22	0	1	f	t
17420574	SAIS-101	0	1	f	t
17420574	SADG-27	0	1	f	t
17420574	SAIS-104	0	1	f	t
17420576	SADG-20	0	1	f	t
17420576	SAIS-100	0	1	f	t
17420576	SADG-22	0	1	f	t
17420576	SAIS-101	0	1	f	t
17420576	SADG-27	0	1	f	t
17420576	SAIS-104	0	1	f	t
17420585	SADG-20	0	1	f	t
17420585	SAIS-100	0	1	f	t
17420585	SADG-22	0	1	f	t
17420585	SAIS-101	0	1	f	t
17420585	SADG-27	0	1	f	t
17420585	SAIS-104	0	1	f	t
17420586	SADG-20	0	1	f	t
17420586	SAIS-100	0	1	f	t
17420586	SADG-22	0	1	f	t
17420586	SAIS-101	0	1	f	t
17420586	SADG-27	0	1	f	t
17420586	SAIS-104	0	1	f	t
17420573	SADG-20	0	1	f	t
17420573	SAIS-100	0	1	f	t
17420573	SADG-22	0	1	f	t
17420573	SAIS-101	0	1	f	t
17420573	SADG-27	0	1	f	t
17420573	SAIS-104	0	1	f	t
17420552	SADG-20	0	1	f	t
17420552	SAIS-100	0	1	f	t
17420552	SADG-22	0	1	f	t
17420552	SAIS-101	0	1	f	t
17420552	SADG-27	0	1	f	t
17420552	SAIS-104	0	1	f	t
17420577	SADG-20	0	1	f	t
17420577	SAIS-100	0	1	f	t
17420577	SADG-22	0	1	f	t
17420577	SAIS-101	0	1	f	t
17420577	SADG-27	0	1	f	t
17420577	SAIS-104	0	1	f	t
17420582	SADG-20	0	1	f	t
17420582	SAIS-100	0	1	f	t
17420582	SADG-22	0	1	f	t
17420582	SAIS-101	0	1	f	t
17420582	SADG-27	0	1	f	t
17420582	SAIS-104	0	1	f	t
17420584	SADG-20	0	1	f	t
17420584	SAIS-100	0	1	f	t
17420584	SADG-22	0	1	f	t
17420584	SAIS-101	0	1	f	t
17420584	SADG-27	0	1	f	t
17420584	SAIS-104	0	1	f	t
17420587	SADG-20	0	1	f	t
17420587	SAIS-100	0	1	f	t
17420587	SADG-22	0	1	f	t
17420587	SAIS-101	0	1	f	t
17420587	SADG-27	0	1	f	t
17420587	SAIS-104	0	1	f	t
19420500	SADG-20	0	1	f	t
19420500	SADG-23	0	1	f	t
19420500	SADG-25	0	1	f	t
19420501	SADG-20	0	1	f	t
19420501	SADG-23	0	1	f	t
19420501	SADG-25	0	1	f	t
19420502	SADG-20	0	1	f	t
19420502	SADG-23	0	1	f	t
19420502	SADG-25	0	1	f	t
\.


--
-- Data for Name: carreras; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.carreras (idcarrera, nombre, tipo, total_creditos) FROM stdin;
1	Ing. Sistemas Computacionales	Ingenieria	260
2	Bioquimica	Ingenieria	260
3	Contabilidad	Licenciatura	246
\.


--
-- Data for Name: grupos; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.grupos (idgrupo, nombre, nrocontrol_tutor, cicloescolar, idcarrera, activo) FROM stdin;
1	A-01	13420001	2017	1	t
2	B-01	13420002	2017	1	t
3	C-01	13420003	2017	1	t
4	A-02	13420201	2019	2	t
5	B-02	14420002	2019	2	t
6	C-02	12420003	2019	2	t
7	A-10	11420201	2018	3	t
8	B-20	11420202	2018	3	t
9	C-30	12420103	2018	3	t
\.


--
-- Data for Name: materias; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.materias (codigo_materia, nombre, creditos) FROM stdin;
SADG-20	Tutorias	1
SADG-21	Fisica	4
SADG-22	Contabilidad	4
SADG-23	Etica	4
SADG-25	Desarrollo Sustentable	4
SADG-26	Calculo Diferencial	4
SADG-27	Calculo Integral	4
SADG-28	Calculo Vectorial	4
SADG-29	Algebra Lineal	4
SADG-30	Metodos numericos	4
SADG-31	Ecuaciones Diferenciales	4
SAIS-100	Estructura de Datos	5
SAIS-101	Poo	5
SAIS-102	Fundamentos programacion	5
SAIS-103	Fundamentos elecomunicaciones	4
SAIS-104	Admin. Redes	4
SABI-200	Soluciones	5
SABI-201	Postres	5
SABI-202	Analisis quimico	5
SABI-203	Fundamentos bioquimica	4
SABI-204	Lab. clinico	4
SACO-300	Finanzas	5
SACO-301	Evacion impuestos	5
SACO-302	El SAT	5
SACO-303	Contabilidad 1	4
SACO-304	Acciones	4
\.


--
-- Data for Name: tutores; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.tutores (nrocontrol, nombre, apellido1, apellido2, idcarrera, password) FROM stdin;
13420001	Othoniel	Rivera	Mendez	1	12345
13420002	Dalet	Villanueva	Mascort	1	12345
13420003	Leonardo	Martinez	Gonzalez	1	12345
13420201	Pedro	Parker	Garcia	2	12345
14420002	Antonio	Stark	Gil	2	12345
12420003	Luis Miguel	Fernandez	Aguilar	2	12345
11420201	Vicente	Fernandez	Figueroa	3	12345
11420202	Elon	Musk	Magallon	3	12345
12420103	Mark	Zucaritas	Villanueva	3	12345
\.


--
-- Name: carreras_idcarrera_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.carreras_idcarrera_seq', 3, true);


--
-- Name: grupo_tutorias_idgrupo_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.grupo_tutorias_idgrupo_seq', 9, true);


--
-- Name: alumnos alumnos_nroc_pk; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.alumnos
    ADD CONSTRAINT alumnos_nroc_pk PRIMARY KEY (nrocontrol);


--
-- Name: carreras carreras_pk; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.carreras
    ADD CONSTRAINT carreras_pk PRIMARY KEY (idcarrera);


--
-- Name: carreras carreras_un; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.carreras
    ADD CONSTRAINT carreras_un UNIQUE (nombre);


--
-- Name: grupos grupo_tutorias_pk; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.grupos
    ADD CONSTRAINT grupo_tutorias_pk PRIMARY KEY (idgrupo);


--
-- Name: grupos grupo_tutorias_un; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.grupos
    ADD CONSTRAINT grupo_tutorias_un UNIQUE (nombre);


--
-- Name: materias materias_pk; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.materias
    ADD CONSTRAINT materias_pk PRIMARY KEY (codigo_materia);


--
-- Name: tutores tutores_pk; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.tutores
    ADD CONSTRAINT tutores_pk PRIMARY KEY (nrocontrol);


--
-- Name: alumnos alumnos_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.alumnos
    ADD CONSTRAINT alumnos_fk FOREIGN KEY (idgrupo) REFERENCES public.grupos(idgrupo) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: alumnos_materias alumnos_materias_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.alumnos_materias
    ADD CONSTRAINT alumnos_materias_fk FOREIGN KEY (nrocontrol) REFERENCES public.alumnos(nrocontrol);


--
-- Name: alumnos_materias alumnos_materias_fk_1; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.alumnos_materias
    ADD CONSTRAINT alumnos_materias_fk_1 FOREIGN KEY (codigo_materia) REFERENCES public.materias(codigo_materia);


--
-- Name: grupos grupos_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.grupos
    ADD CONSTRAINT grupos_fk FOREIGN KEY (nrocontrol_tutor) REFERENCES public.tutores(nrocontrol);


--
-- Name: grupos grupos_fk_idcar; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.grupos
    ADD CONSTRAINT grupos_fk_idcar FOREIGN KEY (idcarrera) REFERENCES public.carreras(idcarrera);


--
-- Name: tutores tutores_fk; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.tutores
    ADD CONSTRAINT tutores_fk FOREIGN KEY (idcarrera) REFERENCES public.carreras(idcarrera);


--
-- PostgreSQL database dump complete
--

